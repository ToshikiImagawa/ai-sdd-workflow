---
name: vibe-detector
description: "実装開始前に自動実行され、ユーザーの指示を分析してVibe Coding（曖昧な指示によりAIが未定義要件を推測する問題）を検出します。「いい感じに」「適当に」「前と同じように」などの曖昧な表現、仕様不足、不明確な要件を発見した場合に警告を表示し、明確化を促します。"
version: 2.3.1
license: MIT
---

# Vibe Detector - 曖昧な指示の自動検出

ユーザーの入力を分析し、Vibe Coding（曖昧な指示によりAIが未定義要件を推測せざるを得ない問題）を検出します。

## 前提条件

**実行前に必ず AI-SDD原則ドキュメントを読み込んでください。**

AI-SDD原則ドキュメントのパス: `.sdd/AI-SDD-PRINCIPLES.md`

**注意**: このファイルはセッション開始時に自動的に最新化されます。

AI-SDDの原則を理解してください。

このスキルはAI-SDD原則に従ってVibe Codingを検出します。

### ディレクトリパスの解決

**環境変数 `SDD_*` を使用してディレクトリパスを解決します。**

| 環境変数                     | デフォルト値               | 説明              |
|:-------------------------|:---------------------|:----------------|
| `SDD_ROOT`               | `.sdd`               | ルートディレクトリ       |
| `SDD_REQUIREMENT_PATH`   | `.sdd/requirement`   | PRD/要求仕様書ディレクトリ |
| `SDD_SPECIFICATION_PATH` | `.sdd/specification` | 仕様書・設計書ディレクトリ   |
| `SDD_TASK_PATH`          | `.sdd/task`          | タスクログディレクトリ     |

**パス解決の優先順位:**

1. 環境変数 `SDD_*` が設定されている場合はそれを使用
2. 環境変数がない場合は `.sdd-config.json` を確認
3. どちらもない場合はデフォルト値を使用

以下のドキュメントではデフォルト値を使用しますが、環境変数または設定ファイルが存在する場合はカスタム値に置き換えてください。

## 検出パターン

### 曖昧な指示

| パターン        | 例                       |
|:------------|:------------------------|
| **主観的表現**   | 「いい感じに」「適当に」「うまく」「きれいに」 |
| **程度の不明確さ** | 「もっと速く」「少し改善」「だいたい動けば」  |
| **範囲の曖昧さ**  | 「あの機能」「前のやつ」「いつもの」      |
| **暗黙の前提**   | 「前と同じように」「いつも通りに」「当然〜」  |
| **優先度の曖昧さ** | 「できれば」「余裕があれば」「ついでに」    |

### 仕様の欠如

| パターン          | 例                  |
|:--------------|:-------------------|
| **要件の不足**     | 「〜機能を作って」（詳細なし）    |
| **入出力の未定義**   | 引数、戻り値、エラーケースの記載なし |
| **境界条件の不明**   | 最大値、最小値、エッジケースの未定義 |
| **エラー処理の未定義** | 異常系の動作が不明          |

### 範囲の不明確さ

| パターン        | 例                        |
|:------------|:-------------------------|
| **対象の曖昧さ**  | 「パフォーマンスを改善」（どこの？何を基準に？） |
| **影響範囲の不明** | 「リファクタリング」（どの範囲？）        |
| **完了条件の欠如** | いつ完了とするかが不明              |

## リスク評価基準

| レベル      | 条件              | 対応                  |
|:---------|:----------------|:--------------------|
| 🔴 **高** | 仕様書なし + 曖昧な指示   | 実装前に仕様書作成を**必須**とする |
| 🟡 **中** | 仕様書あり + 曖昧な部分あり | 曖昧な箇所を明確化してから実装     |
| 🟢 **低** | 仕様書あり + 要件明確    | 実装を開始可能             |

## 検出時の対応フロー

```
1. 曖昧な箇所を特定
   ↓
2. リスクレベルを判定
   ↓
3. ユーザーに確認・明確化を依頼
   ├─ 明確化された → 実装に進む
   └─ 拒否された → 4へ
   ↓
4. 仕様書の作成/更新を提案
   ├─ 承諾された → 仕様書作成後に実装
   └─ 拒否された → 5へ
   ↓
5. リスクを明示的に警告
   ↓
6. 推測した仕様を task/ に記録
   ↓
7. 検証ポイントを設定して実装
```

## 出力フォーマット

リスク検出結果の出力には [templates/risk_report.md](templates/risk_report.md) を使用してください。

**テンプレートが存在しない場合**: 以下の構造に従って出力を生成してください：

```markdown
# Vibe Coding リスクレポート

**検出日**: {YYYY-MM-DD}
**リスクレベル**: 🔴 高 / 🟡 中 / 🟢 低

## 検出された問題

- {ユーザー入力から具体例を示した問題の説明}
- {問題の説明...}

## 不足している情報

- {何が不明確か、何が欠けているか}
- {どのような仮定が必要になるか}

## 推奨アクション

1. {要件を明確化するための具体的なアクション}
2. {具体的なアクション...}

## 明確化せずに進めた場合のリスク

- 要件の誤解による再実装のリスク
- エッジケース未処理によるバグ混入のリスク
- 技術的負債の蓄積リスク
```

## 仕様不足時のエスカレーション

ユーザーが仕様書作成を拒否した場合でも、以下の最低限のガードレールを確保：

### 1. 推測仕様の明文化

推測仕様書の作成には [templates/assumed_spec.md](templates/assumed_spec.md) を使用してください。

**テンプレートが存在しない場合**: 以下の構造に従ってドキュメントを生成してください：

```markdown
# 推測仕様書（Assumed Specification）

⚠️ **警告**: この仕様書は曖昧な要件から推測されたものであり、ユーザーの意図と一致しない可能性があります。

**作成日**: {YYYY-MM-DD}
**元となった要求**: {ユーザーの元の要求}

## 行った仮定

1. {仮定とその理由}
2. {仮定...}

## 推測された要件

### 機能要件

- {推測された要件}
- {推測された要件...}

### 非機能要件

- {推測されたNFR（該当する場合）}

## 検証が必要な項目

- [ ] {ユーザーと確認すべき項目}
- [ ] {確認すべき項目...}

## 既知のリスク

- {仮定から生じるリスク}
- {リスク...}
```

**保存先**: `.sdd/task/{ticket}/assumed-spec.md`

### 2. 検証ポイントの設定

実装完了時にユーザーと確認すべき項目をリスト化：

- 推測した仕様が意図と一致しているか
- エッジケースの動作が期待通りか
- 非機能要件（パフォーマンス等）が満たされているか

### 3. リスクの可視化

仕様不足による潜在的な問題を明示：

- 再実装のリスク
- バグ混入のリスク
- 技術的負債の蓄積リスク

## 注意事項

- このスキルは**検出と警告**を行うもので、実装をブロックするものではない
- 最終的な判断はユーザーに委ねる
- 警告を無視して実装する場合は、必ず推測仕様を記録する
- 検出精度を高めるため、プロジェクトの既存仕様書も参照する
