---
name: check_spec
description: "実装コードと仕様書の整合性をチェックし、差異を検出する"
---

# Check Spec - 仕様書整合性チェック

実装コードと仕様書（`*_spec.md`, `*_design.md`）の整合性を確認し、差異を検出します。

## 前提条件

**sdd-workflow エージェントの原則に従って整合性チェックを行います。**

### ドキュメント間の依存関係（参照）

```
実装 → *_design.md → *_spec.md → requirement-diagram/
```

## 入力

$ARGUMENTS

### 入力例

```
/check_spec user-auth
/check_spec task-management
/check_spec  # 引数なしの場合は全仕様書を対象
```

## 処理フロー

### 1. 対象仕様書の特定

```
引数あり → .docs/specification/{引数}_spec.md, {引数}_design.md を対象
引数なし → .docs/specification/ 配下の全ファイルを対象
```

### 2. 仕様書の読み込み

対象の仕様書から以下の情報を抽出：

**`*_spec.md` から抽出**:

| 項目         | 説明           |
|:-----------|:-------------|
| **公開API**  | 関数名、引数、戻り値の型 |
| **データモデル** | 型定義、インターフェース |
| **機能要件**   | 実装すべき機能のリスト  |

**`*_design.md` から抽出**:

| 項目             | 説明                     |
|:---------------|:-----------------------|
| **モジュール構成**    | ディレクトリ構造、ファイル構成        |
| **技術スタック**     | 使用ライブラリ、フレームワーク        |
| **インターフェース定義** | 各レイヤーのインターフェース定義 |

### 3. 実装コードの確認

仕様書に記載された内容に対応するコードを検索：

- API・関数の検索（プロジェクトの言語に応じた方法で検索）
- 型定義・データモデルの検索
- モジュール・ファイルの存在確認

### 4. 整合性チェック項目

| チェック対象        | 確認内容                | 重要度 |
|:--------------|:--------------------|:----|
| **API シグネチャ** | 関数名、引数、戻り値が一致するか    | 高   |
| **型定義**       | インターフェース、型が一致するか    | 高   |
| **モジュール構成**   | ディレクトリ・ファイル構造が一致するか | 中   |
| **機能要件**      | 仕様に記載された機能が実装されているか | 高   |
| **技術スタック**    | 記載されたライブラリが使用されているか | 低   |

### 5. 差異の分類

検出した差異を以下のように分類：

**🔴 Critical（即座に対応が必要）**:

- APIシグネチャの不一致（引数、戻り値の型）
- 仕様に記載された機能が未実装
- 型定義の不一致

**🟡 Warning（対応推奨）**:

- モジュール構成の不一致
- ドキュメントに記載のないクラス・関数の存在
- 命名規則の不一致

**🟢 Info（参考情報）**:

- 技術スタックの軽微な差異
- コメント・ドキュメントの不足

## 出力フォーマット

```markdown
## 仕様書整合性チェック結果

### 対象仕様書

- `.docs/specification/{機能名}_spec.md`
- `.docs/specification/{機能名}_design.md`

### チェック結果サマリー

| カテゴリ | 件数 |
|:---|:---|
| 🔴 Critical | {n} 件 |
| 🟡 Warning | {n} 件 |
| 🟢 Info | {n} 件 |

### 🔴 Critical（即座に対応が必要）

#### 1. {差異のタイトル}

**仕様書の記載**:

```
// *_spec.md より
doSomething(arg: 文字列): Result
```

**実装コード**:

```
// 実装ファイルより
doSomething(arg: 数値): Result  // 引数の型が異なる
```

**推奨アクション**:

- [ ] 仕様書を更新する（実装が正しい場合）
- [ ] 実装を修正する（仕様書が正しい場合）

---

### 🟡 Warning（対応推奨）

#### 1. {差異のタイトル}

**内容**: {差異の詳細}

**推奨アクション**: {対応方法}

---

### 🟢 Info（参考情報）

- {情報1}
- {情報2}

---

### 未実装機能

仕様書に記載されているが、実装が確認できなかった機能：

| 機能    | 仕様書の記載箇所              | ステータス  |
|:------|:----------------------|:-------|
| {機能名} | `*_spec.md` の {セクション} | 🔴 未実装 |

### 仕様書に未記載の実装

実装されているが、仕様書に記載がない機能：

| 実装         | ファイル         | 推奨アクション         |
|:-----------|:-------------|:----------------|
| {関数名/クラス名} | `{ファイルパス}` | 仕様書に追記 / 不要なら削除 |

### 推奨アクション

1. **Critical** の差異を優先的に解消
2. 仕様書または実装のどちらを修正するか判断
3. 修正後、再度 `/check_spec` を実行して確認

```

## チェック実行タイミング

| タイミング | 推奨アクション |
|:---|:---|
| **実装開始前** | 仕様書の存在と内容を確認 |
| **実装完了時** | 仕様との整合性を検証 |
| **PR作成前** | 最終確認として実行 |
| **定期チェック** | ドキュメントの陳腐化を防止 |

## 注意事項

- 仕様書が存在しない場合は、先に `/generate_spec` で作成を推奨
- 差異が多い場合は、仕様書の大幅な更新が必要な可能性あり
- 実装が正しく仕様書が古い場合は、仕様書を更新
- 仕様書が正しく実装が誤っている場合は、実装を修正
