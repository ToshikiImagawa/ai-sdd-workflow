---
name: generate_spec
description: "入力された内容から抽象仕様書（Specification）と技術設計書（Design Doc）を生成する"
---

# Specification & Design Doc Generator

入力された内容から AI-SDD ワークフローに従って以下のドキュメントを生成します：

1. `.docs/specification/{機能名}_spec.md` - 抽象仕様書（Specify フェーズ）
2. `.docs/specification/{機能名}_design.md` - 技術設計書（Plan フェーズ）

## 前提条件

**sdd-workflow エージェントの原則に従って生成を行います。**

生成前に以下を確認してください：

1. プロジェクトに `.docs/` ディレクトリが存在するか
2. テンプレートファイルが存在する場合はそれを使用

## 入力

$ARGUMENTS

## 入力例

```
/generate_spec ユーザー認証機能。
メールアドレスとパスワードによるログイン・ログアウトに対応。
パスワードリセット機能を提供し、セッション管理はJWTトークンで行う。
ログイン状態を確認するAPIと、認証が必要なエンドポイントを保護するミドルウェアを提供する。
```

## 生成ルール

### 1. Vibe Coding リスク評価（最初に実施）

入力内容を分析し、以下の基準でリスクを評価してください：

| リスク  | 条件            | 対応                 |
|:-----|:--------------|:-------------------|
| 🔴 高 | 仕様書なし + 曖昧な指示 | 不足情報をユーザーに確認してから生成 |
| 🟡 中 | 一部の要件が曖昧      | 曖昧な箇所を明確化してから生成    |
| 🟢 低 | 要件が明確         | そのまま生成可能           |

**曖昧な入力の例**:

- 「いい感じに実装して」「適当に」→ 具体的な要件を確認
- 「パフォーマンスを上げて」→ 対象と目標値を確認
- 「前と同じように」→ 参照先を確認

### 2. 入力内容の分析

入力から以下を抽出・推測してください：

**Spec（抽象仕様書）用**:

| 抽出項目       | 説明                | 必須 |
|:-----------|:------------------|:---|
| **機能名**    | ファイル名に使用する識別名     | ✅  |
| **背景**     | なぜこの機能が必要か        | ✅  |
| **目的**     | 何を実現するか           | ✅  |
| **機能要件**   | 必要な機能のリスト         | ✅  |
| **公開API**  | ユーザーが使用するインターフェース |    |
| **データモデル** | 主要な型・エンティティ       |    |
| **振る舞い**   | 主要なユースケース・シーケンス   |    |

**Design Doc（技術設計書）用**:

| 抽出項目         | 説明               | 必須 |
|:-------------|:-----------------|:---|
| **技術スタック**   | 使用する技術・ライブラリ     | ✅  |
| **アーキテクチャ案** | モジュール構成・レイヤー設計   | ✅  |
| **設計判断**     | 技術選定の理由・代替案      |    |
| **非機能要件**    | パフォーマンス・セキュリティ要件 |    |

### 3. 不足情報の確認

入力から判断できない重要な項目がある場合、**生成前に**ユーザーに確認してください：

- 機能の名前が不明
- 必須の抽出項目が入力から推測できない
- 技術スタックの指定がない（既存パターンを踏襲するか確認）
- 曖昧なビジネスルールやエッジケース

### 4. 既存ドキュメントの確認

生成前に以下を確認してください：

```
.docs/specification/{機能名}_spec.md が既に存在するか？
.docs/specification/{機能名}_design.md が既に存在するか？
```

**存在する場合**: ユーザーに上書きするか確認してください。

## 出力形式

### Phase 1: 抽象仕様書（Specify フェーズ）

プロジェクトにテンプレート（`.docs/SPECIFICATION_TEMPLATE.md`）が存在する場合はそれに従ってください。
存在しない場合は以下の構成で生成してください：

```markdown
# {機能名} 仕様書

## 背景

なぜこの機能が必要か

## 概要

何を実現するか

## 機能要件

- 要件1
- 要件2

## API

公開インターフェースの定義

## データモデル

主要な型定義
```

**保存先**: `.docs/specification/{機能名}_spec.md`

### Phase 2: 技術設計書（Plan フェーズ）

抽象仕様書の生成完了後、技術設計書を生成してください。
プロジェクトにテンプレート（`.docs/DESIGN_DOC_TEMPLATE.md`）が存在する場合はそれに従ってください。

**Design Doc で記載すべき内容**:

| セクション      | 内容               | 必須 |
|:-----------|:-----------------|:---|
| 実装ステータス    | 初期は 🔴 未実装       | ✅  |
| 設計目標       | 達成すべき技術目標        | ✅  |
| 技術スタック     | 採用技術と選定理由        | ✅  |
| アーキテクチャ    | システム構成図・モジュール分割  | ✅  |
| 設計判断       | 決定事項・選択肢・理由      | ✅  |
| データモデル     | 具体的な型定義          |    |
| インターフェース定義 | 各レイヤーのインターフェース定義 |    |
| テスト戦略      | テストレベル・カバレッジ目標   |    |

**保存先**: `.docs/specification/{機能名}_design.md`

### Design Doc 生成をスキップする場合

以下の場合は Design Doc の生成をスキップし、ユーザーに確認してください：

- 入力に技術的な情報が全くない
- 既存の設計パターンを踏襲するか不明
- 調査・検討が必要な技術選定がある

## 生成フロー

```
1. 入力内容を分析
   ↓
2. Vibe Coding リスク評価
   ├─ 🔴 高: 不足情報をユーザーに確認 → 回答後に再開
   ├─ 🟡 中: 曖昧な箇所を確認 → 回答後に再開
   └─ 🟢 低: 次のステップへ
   ↓
3. 既存ドキュメントの確認
   └─ 存在する場合: 上書き確認
   ↓
4. 抽象仕様書を生成・保存（Specify）
   ↓
5. Design Doc 生成の確認
   ├─ 技術情報あり: 生成・保存（Plan）
   └─ 技術情報なし: スキップするか確認
   ↓
6. コミット
```

## 生成後のアクション

1. **ファイル保存**:
    - `.docs/specification/{機能名}_spec.md`
    - `.docs/specification/{機能名}_design.md`（生成した場合）

2. **整合性チェック**: 生成したドキュメント間の整合性を確認

3. **コミット**:
    - Spec のみ: `[spec] {機能名}の抽象仕様書を追加`
    - 両方: `[docs] {機能名}の抽象仕様書と技術設計書を追加`
